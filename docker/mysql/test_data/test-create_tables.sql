DROP DATABASE if exists n6;
DROP DATABASE if exists auth_db;
CREATE DATABASE n6 CHARACTER SET utf8 COLLATE utf8_unicode_ci;
CREATE DATABASE auth_db CHARACTER SET utf8 COLLATE utf8_unicode_ci;

use n6;

SET GLOBAL max_allowed_packet=1073741824;

CREATE TABLE n6.event (
    id BINARY(16) NOT NULL, 
    rid BINARY(16) NOT NULL, 
    source VARCHAR(32) NOT NULL, 
    origin ENUM('c2','dropzone','proxy','p2p-crawler','p2p-drone','sinkhole','sandbox','honeypot','darknet','av','ids','waf'), 
    restriction ENUM('public','need-to-know','internal') NOT NULL, 
    confidence ENUM('low','medium','high') NOT NULL, 
    category ENUM('bots','cnc','dos-victim','malurl','phish','proxy','sandbox-url','scanning','server-exploit','spam','other','spam-url','amplifier','tor','dos-attacker','vulnerable','backdoor','dns-query','flow','flow-anomaly','fraud','leak','webinject','malware-action','deface', 'scam') NOT NULL,
    time DATETIME NOT NULL, 
    name VARCHAR(255), 
    md5 BINARY(16), 
    sha1 BINARY(20), 
    proto ENUM('tcp','udp','icmp'), 
    address MEDIUMTEXT, 
    ip INTEGER UNSIGNED NOT NULL, 
    asn INTEGER UNSIGNED, 
    cc VARCHAR(2), 
    sport INTEGER, 
    dip INTEGER UNSIGNED, 
    dport INTEGER, 
    url VARCHAR(2048), 
    fqdn VARCHAR(255), 
    target VARCHAR(100), 
    custom MEDIUMTEXT, 

    expires DATETIME, 
    status ENUM('active','delisted','expired','replaced'), 
    replaces BINARY(16), 

    until DATETIME, 
    count SMALLINT,
    modified DATETIME,
    PRIMARY KEY (id,time,ip)
    )
    ENGINE=InnoDB
    DEFAULT CHARSET=utf8 
    COLLATE=utf8_unicode_ci
    PARTITION BY RANGE COLUMNS(time) 
    (
 PARTITION p201212 VALUES LESS THAN ('2013-01-01'),
 PARTITION p201301 VALUES LESS THAN ('2013-02-01'),
 PARTITION p201302 VALUES LESS THAN ('2013-03-01'),
 PARTITION p201303 VALUES LESS THAN ('2013-04-01'),
 PARTITION p201304 VALUES LESS THAN ('2013-05-01'),
 PARTITION p201305 VALUES LESS THAN ('2013-06-01'),
 PARTITION p201306 VALUES LESS THAN ('2013-07-01'),
 PARTITION p201307 VALUES LESS THAN ('2013-08-01'),
 PARTITION p201308 VALUES LESS THAN ('2013-09-01'),
 PARTITION p201309 VALUES LESS THAN ('2013-10-01'),
 PARTITION p201310 VALUES LESS THAN ('2013-11-01'),
 PARTITION p201311 VALUES LESS THAN ('2013-12-01'),
 PARTITION p201312 VALUES LESS THAN ('2014-01-01'),
 PARTITION p201401 VALUES LESS THAN ('2014-02-01'),
 PARTITION p201402 VALUES LESS THAN ('2014-03-01'),
 PARTITION p201403 VALUES LESS THAN ('2014-04-01'),
 PARTITION p201404 VALUES LESS THAN ('2014-05-01'),
 PARTITION p201405 VALUES LESS THAN ('2014-06-01'),
 PARTITION p201406 VALUES LESS THAN ('2014-07-01'),
 PARTITION p201407 VALUES LESS THAN ('2014-08-01'),
 PARTITION p201408 VALUES LESS THAN ('2014-09-01'),
 PARTITION p201409 VALUES LESS THAN ('2014-10-01'),
 PARTITION p201410 VALUES LESS THAN ('2014-11-01'),
 PARTITION p201411 VALUES LESS THAN ('2014-12-01'),
 PARTITION p201412 VALUES LESS THAN ('2015-01-01'),
 PARTITION p201501 VALUES LESS THAN ('2015-02-01'),
 PARTITION p201502 VALUES LESS THAN ('2015-03-01'),
 PARTITION p201503 VALUES LESS THAN ('2015-04-01'),
 PARTITION p201504 VALUES LESS THAN ('2015-05-01'),
 PARTITION p201505 VALUES LESS THAN ('2015-06-01'),
 PARTITION p201506 VALUES LESS THAN ('2015-07-01'),
 PARTITION p201507 VALUES LESS THAN ('2015-08-01'),
 PARTITION p201508 VALUES LESS THAN ('2015-09-01'),
 PARTITION p201509 VALUES LESS THAN ('2015-10-01'),
 PARTITION p201510 VALUES LESS THAN ('2015-11-01'),
 PARTITION p201511 VALUES LESS THAN ('2015-12-01'),
 PARTITION p201512 VALUES LESS THAN ('2016-01-01'),
 PARTITION p201601 VALUES LESS THAN ('2016-02-01'),
 PARTITION p201602 VALUES LESS THAN ('2016-03-01'),
 PARTITION p201603 VALUES LESS THAN ('2016-04-01'),
 PARTITION p201604 VALUES LESS THAN ('2016-05-01'),
 PARTITION p201605 VALUES LESS THAN ('2016-06-01'),
 PARTITION p201606 VALUES LESS THAN ('2016-07-01'),
 PARTITION p201607 VALUES LESS THAN ('2016-08-01'),
 PARTITION p201608 VALUES LESS THAN ('2016-09-01'),
 PARTITION p201609 VALUES LESS THAN ('2016-10-01'),
 PARTITION p201610 VALUES LESS THAN ('2016-11-01'),
 PARTITION p201611 VALUES LESS THAN ('2016-12-01'),
 PARTITION p201612 VALUES LESS THAN ('2017-01-01'),
 PARTITION p201701 VALUES LESS THAN ('2017-02-01'),
 PARTITION p201702 VALUES LESS THAN ('2017-03-01'),
 PARTITION p201703 VALUES LESS THAN ('2017-04-01'),
 PARTITION p201704 VALUES LESS THAN ('2017-05-01'),
 PARTITION p201705 VALUES LESS THAN ('2017-06-01'),
 PARTITION p201706 VALUES LESS THAN ('2017-07-01'),
 PARTITION p201707 VALUES LESS THAN ('2017-08-01'),
 PARTITION p201708 VALUES LESS THAN ('2017-09-01'),
 PARTITION p201709 VALUES LESS THAN ('2017-10-01'),
 PARTITION p201710 VALUES LESS THAN ('2017-11-01'),
 PARTITION p201711 VALUES LESS THAN ('2017-12-01'),
 PARTITION p201712 VALUES LESS THAN ('2018-01-01'),
 PARTITION p201801 VALUES LESS THAN ('2018-02-01'),
 PARTITION p201802 VALUES LESS THAN ('2018-03-01'),
 PARTITION p201803 VALUES LESS THAN ('2018-04-01'),
 PARTITION p201804 VALUES LESS THAN ('2018-05-01'),
 PARTITION p201805 VALUES LESS THAN ('2018-06-01'),
 PARTITION p201806 VALUES LESS THAN ('2018-07-01'),
 PARTITION p201807 VALUES LESS THAN ('2018-08-01'),
 PARTITION p201808 VALUES LESS THAN ('2018-09-01'),
 PARTITION p201809 VALUES LESS THAN ('2018-10-01'),
 PARTITION p201810 VALUES LESS THAN ('2018-11-01'),
 PARTITION p201811 VALUES LESS THAN ('2018-12-01'),
 PARTITION p201812 VALUES LESS THAN ('2019-01-01'),
 PARTITION p201901 VALUES LESS THAN ('2019-02-01'),
 PARTITION p201902 VALUES LESS THAN ('2019-03-01'),
 PARTITION p201903 VALUES LESS THAN ('2019-04-01'),
 PARTITION p201904 VALUES LESS THAN ('2019-05-01'),
 PARTITION p201905 VALUES LESS THAN ('2019-06-01'),
 PARTITION p201906 VALUES LESS THAN ('2019-07-01'),
 PARTITION p201907 VALUES LESS THAN ('2019-08-01'),
 PARTITION p201908 VALUES LESS THAN ('2019-09-01'),
 PARTITION p201909 VALUES LESS THAN ('2019-10-01'),
 PARTITION p201910 VALUES LESS THAN ('2019-11-01'),
 PARTITION p201911 VALUES LESS THAN ('2019-12-01'),
 PARTITION p201912 VALUES LESS THAN ('2020-01-01'),
 PARTITION p_max VALUES LESS THAN MAXVALUE);

CREATE TABLE n6.client_to_event (
    id Binary(16) NOT NULL,
    client VARCHAR(32),
    time datetime  NOT NULL
    )
    ENGINE=InnoDB
    DEFAULT CHARSET=utf8 
    COLLATE=utf8_unicode_ci
    PARTITION BY RANGE COLUMNS(time) 
    (
 PARTITION p201212 VALUES LESS THAN ('2013-01-01'),
 PARTITION p201301 VALUES LESS THAN ('2013-02-01'),
 PARTITION p201302 VALUES LESS THAN ('2013-03-01'),
 PARTITION p201303 VALUES LESS THAN ('2013-04-01'),
 PARTITION p201304 VALUES LESS THAN ('2013-05-01'),
 PARTITION p201305 VALUES LESS THAN ('2013-06-01'),
 PARTITION p201306 VALUES LESS THAN ('2013-07-01'),
 PARTITION p201307 VALUES LESS THAN ('2013-08-01'),
 PARTITION p201308 VALUES LESS THAN ('2013-09-01'),
 PARTITION p201309 VALUES LESS THAN ('2013-10-01'),
 PARTITION p201310 VALUES LESS THAN ('2013-11-01'),
 PARTITION p201311 VALUES LESS THAN ('2013-12-01'),
 PARTITION p201312 VALUES LESS THAN ('2014-01-01'),
 PARTITION p201401 VALUES LESS THAN ('2014-02-01'),
 PARTITION p201402 VALUES LESS THAN ('2014-03-01'),
 PARTITION p201403 VALUES LESS THAN ('2014-04-01'),
 PARTITION p201404 VALUES LESS THAN ('2014-05-01'),
 PARTITION p201405 VALUES LESS THAN ('2014-06-01'),
 PARTITION p201406 VALUES LESS THAN ('2014-07-01'),
 PARTITION p201407 VALUES LESS THAN ('2014-08-01'),
 PARTITION p201408 VALUES LESS THAN ('2014-09-01'),
 PARTITION p201409 VALUES LESS THAN ('2014-10-01'),
 PARTITION p201410 VALUES LESS THAN ('2014-11-01'),
 PARTITION p201411 VALUES LESS THAN ('2014-12-01'),
 PARTITION p201412 VALUES LESS THAN ('2015-01-01'),
 PARTITION p201501 VALUES LESS THAN ('2015-02-01'),
 PARTITION p201502 VALUES LESS THAN ('2015-03-01'),
 PARTITION p201503 VALUES LESS THAN ('2015-04-01'),
 PARTITION p201504 VALUES LESS THAN ('2015-05-01'),
 PARTITION p201505 VALUES LESS THAN ('2015-06-01'),
 PARTITION p201506 VALUES LESS THAN ('2015-07-01'),
 PARTITION p201507 VALUES LESS THAN ('2015-08-01'),
 PARTITION p201508 VALUES LESS THAN ('2015-09-01'),
 PARTITION p201509 VALUES LESS THAN ('2015-10-01'),
 PARTITION p201510 VALUES LESS THAN ('2015-11-01'),
 PARTITION p201511 VALUES LESS THAN ('2015-12-01'),
 PARTITION p201512 VALUES LESS THAN ('2016-01-01'),
 PARTITION p201601 VALUES LESS THAN ('2016-02-01'),
 PARTITION p201602 VALUES LESS THAN ('2016-03-01'),
 PARTITION p201603 VALUES LESS THAN ('2016-04-01'),
 PARTITION p201604 VALUES LESS THAN ('2016-05-01'),
 PARTITION p201605 VALUES LESS THAN ('2016-06-01'),
 PARTITION p201606 VALUES LESS THAN ('2016-07-01'),
 PARTITION p201607 VALUES LESS THAN ('2016-08-01'),
 PARTITION p201608 VALUES LESS THAN ('2016-09-01'),
 PARTITION p201609 VALUES LESS THAN ('2016-10-01'),
 PARTITION p201610 VALUES LESS THAN ('2016-11-01'),
 PARTITION p201611 VALUES LESS THAN ('2016-12-01'),
 PARTITION p201612 VALUES LESS THAN ('2017-01-01'),
 PARTITION p201701 VALUES LESS THAN ('2017-02-01'),
 PARTITION p201702 VALUES LESS THAN ('2017-03-01'),
 PARTITION p201703 VALUES LESS THAN ('2017-04-01'),
 PARTITION p201704 VALUES LESS THAN ('2017-05-01'),
 PARTITION p201705 VALUES LESS THAN ('2017-06-01'),
 PARTITION p201706 VALUES LESS THAN ('2017-07-01'),
 PARTITION p201707 VALUES LESS THAN ('2017-08-01'),
 PARTITION p201708 VALUES LESS THAN ('2017-09-01'),
 PARTITION p201709 VALUES LESS THAN ('2017-10-01'),
 PARTITION p201710 VALUES LESS THAN ('2017-11-01'),
 PARTITION p201711 VALUES LESS THAN ('2017-12-01'),
 PARTITION p201712 VALUES LESS THAN ('2018-01-01'),
 PARTITION p201801 VALUES LESS THAN ('2018-02-01'),
 PARTITION p201802 VALUES LESS THAN ('2018-03-01'),
 PARTITION p201803 VALUES LESS THAN ('2018-04-01'),
 PARTITION p201804 VALUES LESS THAN ('2018-05-01'),
 PARTITION p201805 VALUES LESS THAN ('2018-06-01'),
 PARTITION p201806 VALUES LESS THAN ('2018-07-01'),
 PARTITION p201807 VALUES LESS THAN ('2018-08-01'),
 PARTITION p201808 VALUES LESS THAN ('2018-09-01'),
 PARTITION p201809 VALUES LESS THAN ('2018-10-01'),
 PARTITION p201810 VALUES LESS THAN ('2018-11-01'),
 PARTITION p201811 VALUES LESS THAN ('2018-12-01'),
 PARTITION p201812 VALUES LESS THAN ('2019-01-01'),
 PARTITION p201901 VALUES LESS THAN ('2019-02-01'),
 PARTITION p201902 VALUES LESS THAN ('2019-03-01'),
 PARTITION p201903 VALUES LESS THAN ('2019-04-01'),
 PARTITION p201904 VALUES LESS THAN ('2019-05-01'),
 PARTITION p201905 VALUES LESS THAN ('2019-06-01'),
 PARTITION p201906 VALUES LESS THAN ('2019-07-01'),
 PARTITION p201907 VALUES LESS THAN ('2019-08-01'),
 PARTITION p201908 VALUES LESS THAN ('2019-09-01'),
 PARTITION p201909 VALUES LESS THAN ('2019-10-01'),
 PARTITION p201910 VALUES LESS THAN ('2019-11-01'),
 PARTITION p201911 VALUES LESS THAN ('2019-12-01'),
 PARTITION p201912 VALUES LESS THAN ('2020-01-01'),
 PARTITION p_max VALUES LESS THAN MAXVALUE);

