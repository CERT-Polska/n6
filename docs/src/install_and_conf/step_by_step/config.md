##  *n6* related files

Let's store the default *n6* generated certs in `/home/dataman/certs` for convenience.

```bash
$ cp -rf /home/dataman/n6/etc/ssl/generated_certs/ /home/dataman/certs
```

Create directories for *n6* pipeline configuration files and `python-eggs` for n6 components cache and set appropriate permissions:

```bash
$ mkdir -p  /home/dataman/{.n6,logs} \
        /home/dataman/.cache/n6/n6api/python3k-eggs \
        /home/dataman/.cache/n6/n6portal/python3k-eggs \
        /home/dataman/.cache/n6/n6adminpanel/python3k-eggs
$ sudo chown -R dataman:www-data \
        /home/dataman/.cache/n6/n6api/python3k-eggs \
        /home/dataman/.cache/n6/n6portal/python3k-eggs \
        /home/dataman/.cache/n6/n6adminpanel/python3k-eggs
$ sudo chmod -R 755 \
        /home/dataman/.cache/n6/n6api/python3k-eggs \
        /home/dataman/.cache/n6/n6portal/python3k-eggs \
        /home/dataman/.cache/n6/n6adminpanel/python3k-eggs
```

## *n6* pipelines configuration files


Copy the configuration files for the *n6* pipeline into appropriate directories:

```bash
$ cp -f /home/dataman/n6/etc/n6/*.conf /home/dataman/.n6/
```

The configuration files in `/home/dataman/.n6`:

```bash
$ ls /home/dataman/.n6/
00_global.conf  00_pipeline.conf
[...]
05_enrich.conf  07_aggregator.conf  07_comparator.conf
[...]
60_abuse_ch.conf  60_amqp.conf  60_cert_pl.conf  60_cesnet_cz.conf  60_dan_tv.conf
[...]
logging.conf
```

### Recorder (Event DB) conf

Edit `/home/dataman/.n6/21_recorder.conf`, section `recorder`. Primarily,
set a proper database URI - SQL _event_ database (URI should include username, password,
hostname and database name):

```ini
[recorder]
uri = mysql://root:yourMysqlPassword@localhost/n6
echo = 0
wait_timeout = 28800
```

### Rabbitmq conf

_n6_ configuration for RabbitMQ lies in section `rabbitmq`, in the file:  
`/home/dataman/.n6/00_global.conf`

Change the value of the `host` key option if the RabbitMQ service is installed 
on a different server. 
If the broker is on the local machine:

```ini
[rabbitmq]
host = localhost
```

TLS-enabled server requires certificate/key pair that it uses to encrypt traffic sent on the 
connection. The example certificate/key pairs have been generated by tools `etc/ssl/generate_ca.sh`,
`etc/ssl/generate_certs.sh` and placed in the directory `etc/ssl/generated_certs`. 
You can use them to configure the connection or generate new ones.
Adjust the file paths to the certificate storage location.

```ini
ssl_ca_certs=/home/dataman/certs/n6-CA/cacert.pem
ssl_certfile=/home/dataman/certs/cert.pem
ssl_keyfile=/home/dataman/certs/key.pem
```

You can learn more about those files in [Configuration of _n6_ Pipeline](pipeline_config.md) section of this tutorial

## node installation

First create a directory for the new repository's keyring:

```bash
$ mkdir -p /etc/apt/keyrings
```

Then download the new repository's GPG key and save it in the keyring directory:

```bash
$ curl -fsSL https://deb.nodesource.com/gpgkey/nodesource-repo.gpg.key | sudo gpg --dearmor -o /etc/apt/keyrings/nodesource.gpg
```

Add the keyring to nodesource list:

```bash
$ echo "deb [signed-by=/etc/apt/keyrings/nodesource.gpg] https://deb.nodesource.com/node_22.x nodistro main" | sudo tee /etc/apt/sources.list.d/nodesource.list
```

Now pin the deb.nodesource.com (as root):

```bash
$ echo "Package: nodejs" >> /etc/apt/preferences.d/preferences
$ echo "Pin: origin deb.nodesource.com" >> /etc/apt/preferences.d/preferences
$ sudo echo "Pin-Priority: 1001" >> /etc/apt/preferences.d/preferences
```

Install node & yarn:

```bash
$ sudo apt update && \
    sudo apt install -y nodejs && \
    sudo npm install -g npm@9 && \
    sudo npm install --global yarn
```

## RabbitMQ Configuration

If you do not provide a configuration file for RabbitMQ, default values will be used. Or you
can use the example configuration from `n6/etc/rabbitmq/conf/rabbitmq.conf`, by copying
the file to `/etc/rabbitmq`. Replace the paths to the certificate files.

```text
ssl_options.cacertfile = /home/dataman/certs/n6-CA/cacert.pem
ssl_options.certfile = /home/dataman/certs/cert.pem
ssl_options.keyfile = /home/dataman/certs/key.pem
```

Restart the `rabbitmq-server` process afterwards:

```bash
$ sudo service rabbitmq-server restart
```

To ensure everything is OK, sign in to the RabbitMQ web management interface through your
web browser. The default address is `http://localhost:15672`, or `https://localhost:15671`
if you have used the example config. You can use default `guest` credentials:

```text
default user: guest
default password: guest
```

If you copied the configuration file, you might create a new user, allow the user to use the _Management GUI_ and
grant read/write permissions to resources within `/` vhost.
Replace <username> in script below with `login@example.com`:

```bash
$ sudo rabbitmqctl add_user <username> <password>
$ sudo rabbitmqctl set_user_tags <username> management
$ sudo rabbitmqctl set_permissions -p / <username> ".*" ".*" ".*"
```

To make the new user an administrator, set him the `administrator` tag:

```bash
$ sudo rabbitmqctl set_user_tags <username> administrator
```